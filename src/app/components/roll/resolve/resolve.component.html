<div class="dialog" [formGroup]="rollState">
  <div>Rolling: {{step}}-{{rollState.value | json}}</div>
  <div *ngIf="data.roll.target === 'open'; else targetValue">
    Open Difficulty
  </div>
  <ng-template #targetValue>
    <div>Target: {{data.roll.target}}</div>
  </ng-template>
  <div *ngIf="step === 'pickSkill'">
    <div>Select Skill to Roll</div>
    <div *ngFor="let skill of data.skills" (click)="selectSkill(skill)">
      {{skill.name}}: {{skill.levelName}}
    </div>
  </div>
  <div *ngIf="step === 'pickAttribute'">
    <div>Select Attribute</div>
    <div *ngFor="let attribute of attributes" class="attribute"
        (click)="selectAttribute(attribute)">
      <div class="attributeName">
        {{attribute.name}}:
      </div>
      <div class="wound" *ngIf="attribute.wound; else unwounded">
        <mat-icon>sentiment_very_dissatisfied</mat-icon>
      </div>
      <ng-template #unwounded>
        <div class="currentPool"
            [ngClass]="attribute.current < 2 ? 'dangerPool' : 'okayPool'">
          Pool: {{ attribute.current }}
        </div>
        <div class="maxPool">
          /{{attribute.pool}}
        </div>
        <div class="edge">
          Edge: {{attribute.edge}}
        </div>
      </ng-template>
    </div>
  </div>
  <div *ngIf="step === 'chooseRollType'">
    <button mat-button (click)="autoRoll()">RNG</button>
    <button mat-button (click)="manualRoll()">Manual</button>
  </div>
  <div *ngIf="step === 'manualRoll'">
    <div>Manual Roll Input:</div>
    <ng-container formArrayName="dice">
      <mat-form-field *ngFor="let d of dice.controls; index as i"
          [formControlName]="i">
        <input matInput max="12" min="1" type="number">
      </mat-form-field>
    </ng-container>
    <button mat-button (click)="acceptRoll()">Accept</button>
  </div>
  <div *ngIf="step === 'ready'" formArrayName="dice">
    <div>Rolls:</div>
    <mat-form-field *ngFor="let d of dice; index as i" [formControlName]="i">
      <input matInput max="12" min="1" type="number">
    </mat-form-field>
    <div>Rolled:</div>
    <div>{{die}}</div>
    <mat-form-field formControlName="effort">
      <mat-label>Effort</mat-label>
      <input #effortInput matInput type="number">
    </mat-form-field>
    <div>Total:</div>
    <div>
      {{die + direction * effort}}
    </div>
    <button mat-button (click)="finalize()">Accept</button>
  </div>
</div>