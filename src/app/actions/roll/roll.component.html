<div class="dialog" [formGroup]="rollState">
  <div *ngIf="target">Target: {{target}}</div>
  <div *ngIf="skill">A test of {{skill.name}}!</div>
  <div *ngIf="attribute" class="attribute">
    <div class="attributeName">
      Using {{attribute.name}}:
    </div>
    <div class="wound" *ngIf="attribute.wound; else unwounded">
      <mat-icon>sentiment_very_dissatisfied</mat-icon>
    </div>
    <ng-template #unwounded>
      <div class="currentPool">
        {{attribute.edge ? '+'+attribute.edge+' ' : ''}}{{ attribute.current }}
        /
        {{attribute.pool}}
      </div>
    </ng-template>
  </div>
  <div *ngIf="step === 'pickSkill'">
    <div>Select Skill to Roll</div>
    <div *ngFor="let skill of skills" (click)="selectSkill(skill)">
      {{skill.name}}: {{skill.level}}
    </div>
  </div>
  <div *ngIf="step === 'pickAttribute'">
    <mat-form-field>
      <mat-label>Select Attribute</mat-label>
      <mat-select (selectionChange)="selectAttribute($event)">
        <mat-option *ngFor="let attribute of attributes"
            [value]="attribute.name" class="attribute">
          {{attribute.name}}: {{ attribute.current }} / {{attribute.pool}}
          {{attribute.edge ? '+'+attribute.edge+' ' : ''}}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  <div *ngIf="step === 'chooseRollType'" class="rollChooser">
    <div>Choose thy roller.</div>
    <button mat-stroked-button color="primary"
        (click)="autoRoll()">Automatic</button>
    <button mat-stroked-button color="primary"
        (click)="manualRoll()">Manual</button>
  </div>
  <ng-container *ngIf="step === 'finalizing'">
    <div>Thine dice, my liege.</div>
    <mat-form-field *ngFor="let d of dice.controls; index as i"
        formArrayName="dice" class="dieInput"
        [class.chosen]="dice.valid && i === chosenDieIndex">
      <mat-label>d12</mat-label>
      <input matInput min="1" max="12" [formControlName]="i" type="number"
          [readonly]="!manuallyRolling">
      <mat-error *ngIf="d.invalid">Between 1 and 12</mat-error>
    </mat-form-field>
    <div *ngIf="!dice.invalid">
      <button mat-icon-button (click)="decrementEffort()" color="primary"
          class="spinner">
        <mat-icon>remove_circle_outline</mat-icon>
      </button>
      <mat-form-field>
        <mat-label>
          Applyest thou thine effort.
        </mat-label>
        <input #effortInput matInput type="number" min="0"
            formControlName="effort">
        <mat-error *ngIf="effort.invalid">Effort too high</mat-error>
      </mat-form-field>
      <button mat-icon-button (click)="incrementEffort()" color="primary"
          class="spinner">
        <mat-icon>add_circle_outline</mat-icon>
      </button>
    </div>
    <div>Total:</div>
    <div>
      {{die + direction * (effort.value + attribute.edge)}}
    </div>
    <button mat-button (click)="finalize()"
        [disabled]="rollState.invalid">Accept</button>
  </ng-container>
</div>